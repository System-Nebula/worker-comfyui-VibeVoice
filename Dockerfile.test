# Test runner Dockerfile for RunPod worker testing
FROM python:3.10-slim

# Install system dependencies for testing
RUN apt-get update && apt-get install -y \
    curl \
    ffmpeg \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Copy requirements and install Python dependencies
COPY requirements.txt requirements-test.txt ./
RUN pip install --no-cache-dir -r requirements.txt -r requirements-test.txt

# Copy source code
COPY rp_handler.py workflows/ tests/ ./
COPY input/ ./input/

# Create necessary directories
RUN mkdir -p output test_resources/images test_resources/audio

# Set environment variables for testing
ENV PYTHONPATH=/workspace
ENV COMFYUI_URL=http://comfyui:8188

# Default command (can be overridden)
CMD ["python", "-c", "print('Test runner ready')"]